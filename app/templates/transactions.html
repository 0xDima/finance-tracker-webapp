<!-- app/templates/transactions.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Transactions</title>
    <link rel="stylesheet" href="{{ url_for('static', path='../static/css/transactions.css') }}">
</head>
<body>
    <div class="page-container">
        <header class="page-header">
            <h1>Transactions</h1>
        </header>

        <form method="get" class="filter-bar" style="margin-bottom: 16px; display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
            <label for="month">Month:</label>
            <input
                type="month"
                id="month"
                name="month"
                value="{{ current_month }}"
                style="padding: 4px;"
            >

            <label for="search">Search:</label>
            <input
                type="text"
                id="search"
                name="search"
                placeholder="Description or notes"
                value="{{ search }}"
                style="padding: 4px; min-width: 200px;"
            >

            <label for="category">Category:</label>
            <select
                id="category"
                name="category"
                multiple
                size="4"
                style="padding: 4px; min-width: 160px;"
            >
                {% for cat in all_categories %}
                    <option value="{{ cat }}" {% if cat in selected_categories %}selected{% endif %}>
                        {{ cat }}
                    </option>
                {% endfor %}
            </select>

            <label for="account">Account:</label>
            <select
                id="account"
                name="account"
                multiple
                size="4"
                style="padding: 4px; min-width: 160px;"
            >
                {% for acc in all_accounts %}
                    <option value="{{ acc }}" {% if acc in selected_accounts %}selected{% endif %}>
                        {{ acc }}
                    </option>
                {% endfor %}
            </select>

            <label for="min_amount">Min €:</label>
            <input
                type="number"
                step="0.01"
                id="min_amount"
                name="min_amount"
                value="{{ min_amount }}"
                style="padding: 4px; width: 100px;"
            >

            <label for="max_amount">Max €:</label>
            <input
                type="number"
                step="0.01"
                id="max_amount"
                name="max_amount"
                value="{{ max_amount }}"
                style="padding: 4px; width: 100px;"
            >

            <button type="submit" style="padding: 4px 12px;">
                Apply
            </button>

            <a href="/transactions" style="margin-left: 8px; font-size: 14px;">
                Reset
            </a>
        </form>

        {% set qp = request.query_params %}

        <div class="table-wrapper">
            <table class="transactions-table">
                <thead>
                    <tr>
                        <th>
                            <a href="{{ date_sort_url }}">
                                Date {% if sort == 'date' %}({{ dir }}){% endif %}
                            </a>
                        </th>

                        <th>
                            <a href="{{ amount_sort_url }}">
                                Amount (€) {% if sort == 'amount' %}({{ dir }}){% endif %}
                            </a>
                        </th>
                    </tr>
                </thead>

                <tbody>
                    {% for tx in transactions %}
                    <tr class="main-row">
                        <td>{{ tx.date }}</td>
                        <td>{{ tx.description }}</td>
                        <td>{{ tx.category }}</td>
                        <td class="amount-cell">
                            {% if tx.amount_eur < 0 %}
                                <span class="amount amount-negative">{{ tx.amount_eur }} €</span>
                            {% else %}
                                <span class="amount amount-positive">+{{ tx.amount_eur }} €</span>
                            {% endif %}
                        </td>
                    </tr>

                    <tr class="details-row">
                        <td colspan="4">
                            <div class="details-card">
                                <div class="details-card-header">
                                    <span class="details-label">Transaction details (TxID: {{ tx.id }})</span>
                                    <span class="details-amount-pill {% if tx.amount_eur < 0 %}details-amount-negative{% else %}details-amount-positive{% endif %}">
                                        {% if tx.amount_eur < 0 %}
                                            {{ tx.amount_eur }} €
                                        {% else %}
                                            +{{ tx.amount_eur }} €
                                        {% endif %}
                                    </span>
                                </div>

                                <ul class="details-list">
                                    <li><span>Account:</span> {{ tx.account_name }}</li>
                                    <li><span>Date:</span> {{ tx.date }}</li>
                                    <li><span>Description:</span> {{ tx.description }}</li>
                                    <li><span>Category:</span> {{ tx.category }}</li>
                                    <li><span>Original amount:</span> {{ tx.amount_original }} {{ tx.currency_original }}</li>
                                    <li><span>Amount in EUR:</span> {{ tx.amount_eur }} €</li>
                                </ul>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>

                <tfoot>
                    <tr>
                        <td colspan="4">
                            <div style="margin-top: 12px; padding: 12px; border-top: 1px solid #e5e7eb; display: flex; gap: 24px; flex-wrap: wrap;">
                                <div><strong>Income:</strong> €{{ "%.2f"|format(income_sum) }}</div>
                                <div><strong>Expenses:</strong> €{{ "%.2f"|format(expense_sum) }}</div>
                                <div><strong>Net:</strong> €{{ "%.2f"|format(net_sum) }}</div>
                            </div>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
</body>
</html>