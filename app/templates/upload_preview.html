<!-- upload_preview.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preview Import</title>
    <link rel="stylesheet" href="{{ url_for('static', path='../static/css/upload_preview.css') }}">
</head>
<body>
    <div class="page-container">
        <form id="preview-form" method="post" action="/upload/review">
            <input type="hidden" name="batch_id" value="{{ batch_id }}">

            <header class="page-header">
                <div class="header-content">
                    <div class="header-left">
                        <h1>Preview</h1>
                        <p class="header-subtitle">Review and edit {{ transactions|length }} transactions before importing</p>
                    </div>
                    <div class="header-right">
                        <a href="/dashboard" class="btn-secondary">← Dashboard</a>
                    </div>
                </div>
            </header>

            <div class="summary-card">
                <div class="summary-item">
                    <span class="summary-label">Total Transactions</span>
                    <span class="summary-value">{{ transactions|length }}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Ready to Import</span>
                    <span class="summary-value" id="import-count">{{ transactions|length }}</span>
                </div>
                <div class="summary-hint">
                    <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                        <path d="M7 0C3.13 0 0 3.13 0 7s3.13 7 7 7 7-3.13 7-7-3.13-7-7-7zm0 10.5c-.28 0-.5-.22-.5-.5V7c0-.28.22-.5.5-.5s.5.22.5.5v3c0 .28-.22.5-.5.5zm.5-5h-1V4h1v1.5z" fill="currentColor"/>
                    </svg>
                    <span>Double-click cells to edit • Check boxes to exclude from import</span>
                </div>
            </div>

            <div class="table-card">
                <div class="table-scroll">
                    <table class="transactions-table">
                        <thead>
                            <tr>
                                <th class="col-delete">
                                    <input type="checkbox" id="select-all" class="checkbox">
                                </th>
                                <th class="col-temp-id">ID</th>
                                <th class="col-date">Date</th>
                                <th class="col-account">Account</th>
                                <th class="col-description">Description</th>
                                <th class="col-amount-orig">Original</th>
                                <th class="col-amount-eur">Amount (€)</th>
                                <th class="col-category">Category</th>
                                <th class="col-notes">Notes</th>
                            </tr>
                        </thead>
                        <tbody id="tx-tbody">
                            {% for tx in transactions %}
                            <tr class="tx-row" data-temp-id="{{ tx.temp_id }}">
                                <td class="cell-delete">
                                    <input type="checkbox" class="delete-checkbox checkbox" name="delete_ids" value="{{ tx.temp_id }}">
                                </td>
                                <td class="cell-temp-id">
                                    <span class="temp-id">{{ tx.temp_id }}</span>
                                </td>
                                <td class="cell-date" data-field="date">{{ tx.date }}</td>
                                <td class="cell-account" data-field="account_name">{{ tx.account_name }}</td>
                                <td class="cell-description" data-field="description">{{ tx.description }}</td>
                                <td class="cell-amount-orig" data-field="amount_original">
                                    {{ tx.amount_original }} {{ tx.currency_original }}
                                </td>
                                <td class="cell-amount-eur" data-field="amount_eur">
                                    {% set raw_amt = tx.amount_eur %}
                                    {% if raw_amt is not none %}
                                        {% set amt = raw_amt|float %}
                                        {% if amt < 0 %}
                                            <span class="amount negative">{{ amt }} €</span>
                                        {% else %}
                                            <span class="amount positive">+{{ amt }} €</span>
                                        {% endif %}
                                    {% else %}
                                        <span class="amount">—</span>
                                    {% endif %}
                                </td>
                                <td class="cell-category">
                                    {% set current_cat = tx.category or '' %}
                                    <select class="category-select" data-temp-id="{{ tx.temp_id }}">
                                        <option value="" {% if current_cat == '' %}selected{% endif %}>Uncategorized</option>
                                        <option value="Groceries" {% if current_cat == 'Groceries' %}selected{% endif %}>Groceries</option>
                                        <option value="Transportation" {% if current_cat == 'Transportation' %}selected{% endif %}>Transportation</option>
                                        <option value="Coffee" {% if current_cat == 'Coffee' %}selected{% endif %}>Coffee</option>
                                        <option value="Dining & Restaurants" {% if current_cat == 'Dining & Restaurants' %}selected{% endif %}>Dining & Restaurants</option>
                                        <option value="Shopping" {% if current_cat == 'Shopping' %}selected{% endif %}>Shopping</option>
                                        <option value="Home" {% if current_cat == 'Home' %}selected{% endif %}>Home</option>
                                        <option value="Cash Withdrawals" {% if current_cat == 'Cash Withdrawals' %}selected{% endif %}>Cash Withdrawals</option>
                                        <option value="Entertainment & Subscriptions" {% if current_cat == 'Entertainment & Subscriptions' %}selected{% endif %}>Entertainment & Subscriptions</option>
                                        <option value="Travelling" {% if current_cat == 'Travelling' %}selected{% endif %}>Travelling</option>
                                        <option value="Education & Studying" {% if current_cat == 'Education & Studying' %}selected{% endif %}>Education & Studying</option>
                                        <option value="Other" {% if current_cat == 'Other' %}selected{% endif %}>Other</option>
                                        <option value="Investments" {% if current_cat == 'Investments' %}selected{% endif %}>Investments</option>
                                        <option value="Income" {% if current_cat == 'Income' %}selected{% endif %}>Income</option>
                                    </select>
                                </td>
                                <td class="cell-notes" data-field="notes">
                                    {% if tx.notes %}
                                        {{ tx.notes[:40] }}{% if tx.notes|length > 40 %}…{% endif %}
                                    {% endif %}
                                </td>
                                <td class="hidden-inputs">
                                    <input type="hidden" name="transactions[{{ tx.temp_id }}][date]" value="{{ tx.date }}">
                                    <input type="hidden" name="transactions[{{ tx.temp_id }}][account_name]" value="{{ tx.account_name }}">
                                    <input type="hidden" name="transactions[{{ tx.temp_id }}][description]" value="{{ tx.description }}">
                                    <input type="hidden" name="transactions[{{ tx.temp_id }}][amount_original]" value="{{ tx.amount_original }}">
                                    <input type="hidden" name="transactions[{{ tx.temp_id }}][currency_original]" value="{{ tx.currency_original }}">
                                    <input type="number" step="0.01" name="transactions[{{ tx.temp_id }}][amount_eur]" value="{{ tx.amount_eur if tx.amount_eur is not none else '' }}" class="amount-eur-input">
                                    <input type="hidden" name="transactions[{{ tx.temp_id }}][category]" value="{{ tx.category or '' }}">
                                    <input type="hidden" name="transactions[{{ tx.temp_id }}][notes]" value="{{ tx.notes or '' }}">
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="actions-footer">
                <div class="footer-left">
                    <button type="button" class="btn-secondary" id="add-manual-tx">
                        + Add transaction
                    </button>
                </div>

                <div class="footer-right">
                    <a href="/transactions" class="btn-ghost">Cancel</a>
                    <button type="submit" class="btn-primary">
                        Continue to Review
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M6 3L11 8L6 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
            </div>
        </form>
    </div>

    <script src="{{ url_for('static', path='../static/js/upload_preview.js') }}"></script>
</body>
</html>